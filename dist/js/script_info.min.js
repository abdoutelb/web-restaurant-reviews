"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if("object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}(function(){return function i(a,u,c){function s(t,e){if(!u[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(f)return f(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[t]={exports:{}};a[t][0].call(o.exports,function(e){return s(a[t][1][e]||e)},o,o.exports,i,a,u,c)}return u[t].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,f,t){(function(t){function n(){c=!0;for(var e,t,n=s.length;n;){for(t=s,s=[],e=-1;++e<n;)t[e]();n=s.length}c=!1}var r,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var o=0,i=new e(n),a=t.document.createTextNode("");i.observe(a,{characterData:!0}),r=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(n,0)};else{var u=new t.MessageChannel;u.port1.onmessage=n,r=function(){u.port2.postMessage(0)}}var c,s=[];f.exports=function(e){1!==s.push(e)||c||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){function s(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==s&&u(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function i(t,n,r){f(function(){var e;try{e=n(r)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,e)})}function a(e){var t=e&&e.then;if(e&&"object"==(void 0===e?"undefined":_typeof(e))&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(t,e){function n(e){o||(o=!0,l.reject(t,e))}function r(e){o||(o=!0,l.resolve(t,e))}var o=!1,i=c(function(){e(r,n)});"error"===i.status&&n(i.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}var f=e(1),l={},d=["REJECTED"],v=["FULFILLED"],h=["PENDING"];t.exports=n=r,r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===v||"function"!=typeof t&&this.state===d)return this;var n=new this.constructor(s);return this.state!==h?i(n,this.state===v?e:t,this.outcome):this.queue.push(new o(n,e,t)),n},o.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){l.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)},l.resolve=function(e,t){var n=c(a,t);if("error"===n.status)return l.reject(e,n.value);var r=n.value;if(r)u(e,r);else{e.state=v,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},l.reject=function(e,t){e.state=d,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},n.resolve=function(e){return e instanceof this?e:l.resolve(new this(s),e)},n.reject=function(e){var t=new this(s);return l.reject(t,e)},n.all=function(e){function t(e,t){n.resolve(e).then(function(e){i[t]=e,++a!==r||o||(o=!0,l.resolve(c,i))},function(e){o||(o=!0,l.reject(c,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var i=new Array(r),a=0,u=-1,c=new this(s);++u<r;)t(e[u],u);return c},n.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,r=e.length,o=!1;if(!r)return this.resolve([]);for(var i=-1,a=new this(s);++i<r;)n=e[i],t.resolve(n).then(function(e){o||(o=!0,l.resolve(a,e))},function(e){o||(o=!0,l.reject(a,e))});return a}},{1:1}],3:[function(t,e,n){(function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){function a(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<t.length;o+=1)r.append(t[o]);return r.getBlob(n.type)}}function l(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function i(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function r(e){return"boolean"==typeof j?T.resolve(j):(r=e,new T(function(n){var e=r.transaction(k,F),t=a([""]);e.objectStore(k).put(t,"key"),e.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)},e.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1})).then(function(e){return j=e});var r}function u(e){var t=L[e.name],n={};n.promise=new T(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function s(e){var t=L[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function f(e,t){var n=L[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function o(o,i){return new T(function(e,t){if(L[o.name]=L[o.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},o.db){if(!i)return e(o.db);u(o),o.db.close()}var n=[o.name];i&&n.push(o.version);var r=D.open.apply(D,n);i&&(r.onupgradeneeded=function(e){var t=r.result;try{t.createObjectStore(o.storeName),e.oldVersion<=1&&t.createObjectStore(k)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+o.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+o.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),t(r.error)},r.onsuccess=function(){e(r.result),s(o)}})}function v(e){return o(e,!1)}function h(e){return o(e,!0)}function p(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function m(e){return a([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function g(e){return e&&e.__local_forage_encoded_blob}function y(e){var t=this,n=t._initReady().then(function(){var e=L[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(n,e,e),n}function b(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(0<r&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return T.resolve().then(function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),h(e)}).then(function(){return function(n){u(n);for(var r=L[n.name],o=r.forages,e=0;e<o.length;e++){var t=o[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return n.db=null,v(n).then(function(e){return n.db=e,p(n)?h(n):e}).then(function(e){n.db=r.db=e;for(var t=0;t<o.length;t++)o[t]._dbInfo.db=e}).catch(function(e){throw f(n,e),e})}(e).then(function(){b(e,t,n,r-1)})}).catch(n);n(o)}}function _(e){var t,n,r,o,i,a=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var s=new ArrayBuffer(a),f=new Uint8Array(s);for(t=0;t<u;t+=4)n=x.indexOf(e[t]),r=x.indexOf(e[t+1]),o=x.indexOf(e[t+2]),i=x.indexOf(e[t+3]),f[c++]=n<<2|r>>4,f[c++]=(15&r)<<4|o>>2,f[c++]=(3&o)<<6|63&i;return s}function w(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=x[n[t]>>2],r+=x[(3&n[t])<<4|n[t+1]>>4],r+=x[(15&n[t+1])<<2|n[t+2]>>6],r+=x[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function E(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function R(e,r,o,i,a,u){e.executeSql(o,i,a,function(e,n){n.code===n.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[name],function(e,t){t.rows.length?u(e,n):E(e,r,function(){e.executeSql(o,i,a,u)},u)},u):u(e,n)},u)}function I(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function S(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||0<localStorage.length}function A(t,n){t[n]=function(){var e=arguments;return t.ready().then(function(){return t[n].apply(t,e)})}}function N(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(X(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var B="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},D=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var T=Promise,k="local-forage-detect-blob-support",j=void 0,L={},O=Object.prototype.toString,C="readonly",F="readwrite",M={_driver:"asyncStorage",_initStorage:function(e){function t(){return T.resolve()}var r=this,o={db:null};if(e)for(var n in e)o[n]=e[n];var i=L[o.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},L[o.name]=i),i.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=y);for(var a=[],u=0;u<i.forages.length;u++){var c=i.forages[u];c!==r&&a.push(c._initReady().catch(t))}var s=i.forages.slice(0);return T.all(a).then(function(){return o.db=i.db,v(o)}).then(function(e){return o.db=e,p(o,r._defaultConfig.version)?h(o):e}).then(function(e){o.db=i.db=e,r._dbInfo=o;for(var t=0;t<s.length;t++){var n=s[t];n!==r&&(n._dbInfo.db=o.db,n._dbInfo.version=o.version)}})},_support:function(){try{if(!D)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(a,e){var u=this,t=new T(function(i,n){u.ready().then(function(){b(u._dbInfo,C,function(e,t){if(e)return n(e);try{var r=t.objectStore(u._dbInfo.storeName).openCursor(),o=1;r.onsuccess=function(){var e=r.result;if(e){var t=e.value;g(t)&&(t=m(t));var n=a(t,e.key,o++);void 0!==n?i(n):e.continue()}else i()},r.onerror=function(){n(r.error)}}catch(e){n(e)}})}).catch(n)});return l(t,e),t},getItem:function(i,e){var a=this;i=d(i);var t=new T(function(r,o){a.ready().then(function(){b(a._dbInfo,C,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName).get(i);n.onsuccess=function(){var e=n.result;void 0===e&&(e=null),g(e)&&(e=m(e)),r(e)},n.onerror=function(){o(n.error)}}catch(e){o(e)}})}).catch(o)});return l(t,e),t},setItem:function(u,t,e){var c=this;u=d(u);var n=new T(function(i,a){var e;c.ready().then(function(){return e=c._dbInfo,"[object Blob]"===O.call(t)?r(e.db).then(function(e){return e?t:(r=t,new T(function(n,e){var t=new FileReader;t.onerror=e,t.onloadend=function(e){var t=btoa(e.target.result||"");n({__local_forage_encoded_blob:!0,data:t,type:r.type})},t.readAsBinaryString(r)}));var r}):t}).then(function(o){b(c._dbInfo,F,function(e,t){if(e)return a(e);try{var n=t.objectStore(c._dbInfo.storeName);null===o&&(o=void 0);var r=n.put(o,u);t.oncomplete=function(){void 0===o&&(o=null),i(o)},t.onabort=t.onerror=function(){var e=r.error?r.error:r.transaction.error;a(e)}}catch(e){a(e)}})}).catch(a)});return l(n,e),n},removeItem:function(i,e){var a=this;i=d(i);var t=new T(function(r,o){a.ready().then(function(){b(a._dbInfo,F,function(e,t){if(e)return o(e);try{var n=t.objectStore(a._dbInfo.storeName).delete(i);t.oncomplete=function(){r()},t.onerror=function(){o(n.error)},t.onabort=function(){var e=n.error?n.error:n.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return l(t,e),t},clear:function(e){var i=this,t=new T(function(r,o){i.ready().then(function(){b(i._dbInfo,F,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName).clear();t.oncomplete=function(){r()},t.onabort=t.onerror=function(){var e=n.error?n.error:n.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return l(t,e),t},length:function(e){var i=this,t=new T(function(r,o){i.ready().then(function(){b(i._dbInfo,C,function(e,t){if(e)return o(e);try{var n=t.objectStore(i._dbInfo.storeName).count();n.onsuccess=function(){r(n.result)},n.onerror=function(){o(n.error)}}catch(e){o(e)}})}).catch(o)});return l(t,e),t},key:function(u,e){var c=this,t=new T(function(i,a){u<0?i(null):c.ready().then(function(){b(c._dbInfo,C,function(e,t){if(e)return a(e);try{var n=t.objectStore(c._dbInfo.storeName),r=!1,o=n.openCursor();o.onsuccess=function(){var e=o.result;e?0===u?i(e.key):r?i(e.key):(r=!0,e.advance(u)):i(null)},o.onerror=function(){a(o.error)}}catch(e){a(e)}})}).catch(a)});return l(t,e),t},keys:function(e){var a=this,t=new T(function(o,i){a.ready().then(function(){b(a._dbInfo,C,function(e,t){if(e)return i(e);try{var n=t.objectStore(a._dbInfo.storeName).openCursor(),r=[];n.onsuccess=function(){var e=n.result;e?(r.push(e.key),e.continue()):o(r)},n.onerror=function(){i(n.error)}}catch(e){i(e)}})}).catch(i)});return l(t,e),t},dropInstance:function(a,e){e=i.apply(this,arguments);var t,n=this.config();if((a="function"!=typeof a&&a||{}).name||(a.name=a.name||n.name,a.storeName=a.storeName||n.storeName),a.name){var r=a.name===n.name&&this._dbInfo.db?T.resolve(this._dbInfo.db):v(a).then(function(e){var t=L[a.name],n=t.forages;t.db=e;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=e;return e});t=a.storeName?r.then(function(e){if(e.objectStoreNames.contains(a.storeName)){var o=e.version+1;u(a);var r=L[a.name],i=r.forages;e.close();for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=null,n._dbInfo.version=o}return new T(function(t,n){var r=D.open(a.name,o);r.onerror=function(e){r.result.close(),n(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(a.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,s(n._dbInfo)}}).catch(function(e){throw(f(a,e)||T.resolve()).catch(function(){}),e})}}):r.then(function(e){u(a);var n=L[a.name],r=n.forages;e.close();for(var t=0;t<r.length;t++)r[t]._dbInfo.db=null;return new T(function(t,n){var r=D.deleteDatabase(a.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<r.length;t++)s(r[t]._dbInfo)}).catch(function(e){throw(f(a,e)||T.resolve()).catch(function(){}),e})})}else t=T.reject("Invalid arguments");return l(t,e),t}},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=/^~~local_forage_type~([^~]+)~/,H="__lfsc__:",P=H.length,z="arbf",W="blob",q=P+z.length,V=Object.prototype.toString,Q={serialize:function(t,n){var e="";if(t&&(e=V.call(t)),t&&("[object ArrayBuffer]"===e||t.buffer&&"[object ArrayBuffer]"===V.call(t.buffer))){var r,o=H;t instanceof ArrayBuffer?(r=t,o+=z):(r=t.buffer,"[object Int8Array]"===e?o+="si08":"[object Uint8Array]"===e?o+="ui08":"[object Uint8ClampedArray]"===e?o+="uic8":"[object Int16Array]"===e?o+="si16":"[object Uint16Array]"===e?o+="ur16":"[object Int32Array]"===e?o+="si32":"[object Uint32Array]"===e?o+="ui32":"[object Float32Array]"===e?o+="fl32":"[object Float64Array]"===e?o+="fl64":n(new Error("Failed to get type for BinaryArray"))),n(o+w(r))}else if("[object Blob]"===e){var i=new FileReader;i.onload=function(){var e="~~local_forage_type~"+t.type+"~"+w(this.result);n(H+W+e)},i.readAsArrayBuffer(t)}else try{n(JSON.stringify(t))}catch(e){console.error("Couldn't convert value into a JSON string: ",t),n(null,e)}},deserialize:function(e){if(e.substring(0,P)!==H)return JSON.parse(e);var t,n=e.substring(q),r=e.substring(P,q);if(r===W&&U.test(n)){var o=n.match(U);t=o[1],n=n.substring(o[0].length)}var i=_(n);switch(r){case z:return i;case W:return a([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:_,bufferToString:w},G={_driver:"webSQLStorage",_initStorage:function(e){var r=this,o={db:null};if(e)for(var t in e)o[t]="string"!=typeof e[t]?e[t].toString():e[t];var n=new T(function(t,n){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(t){return n(t)}o.db.transaction(function(e){E(e,o,function(){r._dbInfo=o,t()},function(e,t){n(t)})},n)});return o.serializer=Q,n},_support:"function"==typeof openDatabase,iterate:function(s,e){var t=this,n=new T(function(c,n){t.ready().then(function(){var u=t._dbInfo;u.db.transaction(function(e){R(e,u,"SELECT * FROM "+u.storeName,[],function(e,t){for(var n=t.rows,r=n.length,o=0;o<r;o++){var i=n.item(o),a=i.value;if(a&&(a=u.serializer.deserialize(a)),void 0!==(a=s(a,i.key,o+1)))return void c(a)}c()},function(e,t){n(t)})})}).catch(n)});return l(n,e),n},getItem:function(t,e){var i=this;t=d(t);var n=new T(function(o,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(e){R(e,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[t],function(e,t){var n=t.rows.length?t.rows.item(0).value:null;n&&(n=r.serializer.deserialize(n)),o(n)},function(e,t){n(t)})})}).catch(n)});return l(n,e),n},setItem:function(e,t,n){return function a(u,e,c,s){var f=this;u=d(u);var t=new T(function(o,i){f.ready().then(function(){void 0===e&&(e=null);var n=e,r=f._dbInfo;r.serializer.serialize(e,function(t,e){e?i(e):r.db.transaction(function(e){R(e,r,"INSERT OR REPLACE INTO "+r.storeName+" (key, value) VALUES (?, ?)",[u,t],function(){o(n)},function(e,t){i(t)})},function(e){if(e.code===e.QUOTA_ERR){if(0<s)return void o(a.apply(f,[u,n,c,s-1]));i(e)}})})}).catch(i)});return l(t,c),t}.apply(this,[e,t,n,1])},removeItem:function(o,e){var i=this;o=d(o);var t=new T(function(n,r){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){R(e,t,"DELETE FROM "+t.storeName+" WHERE key = ?",[o],function(){n()},function(e,t){r(t)})})}).catch(r)});return l(t,e),t},clear:function(e){var o=this,t=new T(function(n,r){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){R(e,t,"DELETE FROM "+t.storeName,[],function(){n()},function(e,t){r(t)})})}).catch(r)});return l(t,e),t},length:function(e){var o=this,t=new T(function(r,n){o.ready().then(function(){var t=o._dbInfo;t.db.transaction(function(e){R(e,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(e,t){var n=t.rows.item(0).c;r(n)},function(e,t){n(t)})})}).catch(n)});return l(t,e),t},key:function(o,e){var i=this,t=new T(function(r,n){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){R(e,t,"SELECT key FROM "+t.storeName+" WHERE id = ? LIMIT 1",[o+1],function(e,t){var n=t.rows.length?t.rows.item(0).key:null;r(n)},function(e,t){n(t)})})}).catch(n)});return l(t,e),t},keys:function(e){var r=this,t=new T(function(o,n){r.ready().then(function(){var t=r._dbInfo;t.db.transaction(function(e){R(e,t,"SELECT key FROM "+t.storeName,[],function(e,t){for(var n=[],r=0;r<t.rows.length;r++)n.push(t.rows.item(r).key);o(n)},function(e,t){n(t)})})}).catch(n)});return l(t,e),t},dropInstance:function(n,e){e=i.apply(this,arguments);var r=this.config();(n="function"!=typeof n&&n||{}).name||(n.name=n.name||r.name,n.storeName=n.storeName||r.storeName);var t,o=this;return l(t=n.name?new T(function(e){var t,i;t=n.name===r.name?o._dbInfo.db:openDatabase(n.name,"","",0),e(n.storeName?{db:t,storeNames:[n.storeName]}:(i=t,new T(function(o,n){i.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,t){for(var n=[],r=0;r<t.rows.length;r++)n.push(t.rows.item(r).name);o({db:i,storeNames:n})},function(e,t){n(t)})},function(e){n(e)})})))}).then(function(u){return new T(function(i,a){u.db.transaction(function(r){function e(t){return new T(function(e,n){r.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(e,t){n(t)})})}for(var t=[],n=0,o=u.storeNames.length;n<o;n++)t.push(e(u.storeNames[n]));T.all(t).then(function(){i()}).catch(function(e){a(e)})},function(e){a(e)})})}):T.reject("Invalid arguments"),e),t}},J={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=I(e,this._defaultConfig),S()?((this._dbInfo=t).serializer=Q,T.resolve()):T.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(c,e){var s=this,t=s.ready().then(function(){for(var e=s._dbInfo,t=e.keyPrefix,n=t.length,r=localStorage.length,o=1,i=0;i<r;i++){var a=localStorage.key(i);if(0===a.indexOf(t)){var u=localStorage.getItem(a);if(u&&(u=e.serializer.deserialize(u)),void 0!==(u=c(u,a.substring(n),o++)))return u}}});return l(t,e),t},getItem:function(n,e){var r=this;n=d(n);var t=r.ready().then(function(){var e=r._dbInfo,t=localStorage.getItem(e.keyPrefix+n);return t&&(t=e.serializer.deserialize(t)),t});return l(t,e),t},setItem:function(a,e,t){var u=this;a=d(a);var n=u.ready().then(function(){void 0===e&&(e=null);var i=e;return new T(function(n,r){var o=u._dbInfo;o.serializer.serialize(e,function(e,t){if(t)r(t);else try{localStorage.setItem(o.keyPrefix+a,e),n(i)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}})})});return l(n,t),n},removeItem:function(t,e){var n=this;t=d(t);var r=n.ready().then(function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return l(r,e),r},clear:function(e){var r=this,t=r.ready().then(function(){for(var e=r._dbInfo.keyPrefix,t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}});return l(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return l(t,e),t},key:function(n,e){var r=this,t=r.ready().then(function(){var t,e=r._dbInfo;try{t=localStorage.key(n)}catch(e){t=null}return t&&(t=t.substring(e.keyPrefix.length)),t});return l(t,e),t},keys:function(e){var i=this,t=i.ready().then(function(){for(var e=i._dbInfo,t=localStorage.length,n=[],r=0;r<t;r++){var o=localStorage.key(r);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n});return l(t,e),t},dropInstance:function(t,e){if(e=i.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,o=this;return l(r=t.name?new T(function(e){e(t.storeName?I(t,o._defaultConfig):t.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):T.reject("Invalid arguments"),e),r}},K=function(e,t){for(var n=e.length,r=0;r<n;){if((o=e[r])===(i=t)||"number"==typeof o&&"number"==typeof i&&isNaN(o)&&isNaN(i))return!0;r++}var o,i;return!1},X=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Y={},$={},Z={INDEXEDDB:M,WEBSQL:G,LOCALSTORAGE:J},ee=[Z.INDEXEDDB._driver,Z.WEBSQL._driver,Z.LOCALSTORAGE._driver],te=["dropInstance"],ne=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(te),re={description:"",driver:ee.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},oe=new(function(){function o(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),Z)if(Z.hasOwnProperty(t)){var n=Z[t],r=n._driver;this[t]=r,Y[r]||this.defineDriver(n)}this._defaultConfig=N({},re),this._config=N({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return o.prototype.config=function(e){if("object"===(void 0===e?"undefined":B(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},o.prototype.defineDriver=function(s,e,t){var n=new T(function(t,n){try{var r=s._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!s._driver)return void n(e);for(var o=ne.concat("_initStorage"),i=0,a=o.length;i<a;i++){var u=o[i];if((!K(te,u)||s[u])&&"function"!=typeof s[u])return void n(e)}!function(){for(var e=function(n){return function(){var e=new Error("Method "+n+" is not implemented by the current driver"),t=T.reject(e);return l(t,arguments[arguments.length-1]),t}},t=0,n=te.length;t<n;t++){var r=te[t];s[r]||(s[r]=e(r))}}();var c=function(e){Y[r]&&console.info("Redefining LocalForage driver: "+r),Y[r]=s,$[r]=e,t()};"_support"in s?s._support&&"function"==typeof s._support?s._support().then(c,n):c(!!s._support):c(!0)}catch(e){n(e)}});return c(n,e,t),n},o.prototype.driver=function(){return this._driver||null},o.prototype.getDriver=function(e,t,n){var r=Y[e]?T.resolve(Y[e]):T.reject(new Error("Driver not found."));return c(r,t,n),r},o.prototype.getSerializer=function(e){var t=T.resolve(Q);return c(t,e),t},o.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(n,e,e),n},o.prototype.setDriver=function(e,t,n){function i(){u._config.driver=u.driver()}function a(e){return u._extend(e),i(),u._ready=u._initStorage(u._config),u._ready}var u=this;X(e)||(e=[e]);var r=this._getSupportedDrivers(e),o=null!==this._driverSet?this._driverSet.catch(function(){return T.resolve()}):T.resolve();return this._driverSet=o.then(function(){var e=r[0];return u._dbInfo=null,u._ready=null,u.getDriver(e).then(function(e){var o;u._driver=e._driver,i(),u._wrapLibraryMethodsWithReady(),u._initDriver=(o=r,function(){var r=0;return function e(){for(;r<o.length;){var t=o[r];return r++,u._dbInfo=null,u._ready=null,u.getDriver(t).then(a).catch(e)}i();var n=new Error("No available storage method found.");return u._driverSet=T.reject(n),u._driverSet}()})})}).catch(function(){i();var e=new Error("No available storage method found.");return u._driverSet=T.reject(e),u._driverSet}),c(this._driverSet,t,n),this._driverSet},o.prototype.supports=function(e){return!!$[e]},o.prototype._extend=function(e){N(this,e)},o.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},o.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ne.length;e<t;e++)A(this,ne[e])},o.prototype.createInstance=function(e){return new o(e)},o}());t.exports=oe},{3:3}]},{},[4])(4)});var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var RESTAURANTS_DBNAME="restaurants",NEIBOURHOUDS_DBNAME="neighborhoods",CUISINE_DBNAME="cuisines",OFFLINE_REVIEWS_POST="review_post";self.localforage&&self.localforage.config({name:"Restaurants_App"});var map,DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"fetchRestaurants",value:function(t){fetch(i.DATABASE_URL+"/restaurants").then(function(e){var t=e.json();return i.saveFetchedData(RESTAURANTS_DBNAME,t),t}).then(function(e){t(null,e)})}},{key:"fetchRestaurantById",value:function(e,t){fetch(i.DATABASE_URL+"/restaurants/"+e).then(function(e){return e.json()}).then(function(e){t(null,e)})}},{key:"fetchRestaurantByCuisine",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});o(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});o(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r,o){window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){t?o(null,i.filterByCuisineAndNeighborhood(t,n,r)):i.fetchRestaurants(function(e,t){e?o(e,null):o(null,i.filterByCuisineAndNeighborhood(t,n,r))})})}},{key:"filterByCuisineAndNeighborhood",value:function(e,t,n){var r=e;return"all"!=t&&(r=r.filter(function(e){return e.cuisine_type==t})),"all"!=n&&(r=r.filter(function(e){return e.neighborhood==n})),r}},{key:"fetchFavoriteRestaurantByCuisineAndNeighborhood",value:function(n,r,o){window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){t?o(null,i.filterByFavoriteCuisineAndNeighborhood(t,n,r)):i.fetchFavoriteRestaurants().then(function(e){o(null,i.filterByFavoriteCuisineAndNeighborhood(e,n,r))}).catch(function(e){o(e,null)})})}},{key:"filterByFavoriteCuisineAndNeighborhood",value:function(e,t,n){var r=e;return r="all"!=t?r.filter(function(e){return e.cuisine_type==t&&("true"==e.is_favorite||1==e.is_favorite)}):r.filter(function(e){return"true"==e.is_favorite||1==e.is_favorite}),r="all"!=n?r.filter(function(e){return e.neighborhood==n&&("true"==e.is_favorite||1==e.is_favorite)}):r.filter(function(e){return"true"==e.is_favorite||1==e.is_favorite})}},{key:"fetchNeighborhoods",value:function(r){window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){if(t){var n=i.getUniqueNeighborhoods(t);r(null,n)}else i.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=i.getUniqueNeighborhoods(t);i.saveFetchedData(NEIBOURHOUDS_DBNAME,n),r(null,n)}})})}},{key:"getUniqueNeighborhoods",value:function(n){var r=n.map(function(e,t){return n[t].neighborhood});return r.filter(function(e,t){return r.indexOf(e)==t})}},{key:"fetchCuisines",value:function(r){window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){if(t){var n=i.getUniqueCuisines(t);r(null,n)}else i.fetchRestaurants(function(e,t){if(e)r(e,null);else{var n=i.getUniqueCuisines(t);i.saveFetchedData(CUISINE_DBNAME,n),r(null,n)}})})}},{key:"getUniqueCuisines",value:function(n){var r=n.map(function(e,t){return n[t].cuisine_type});return r.filter(function(e,t){return r.indexOf(e)==t})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){if(e.photograph)return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"fetchRestaurantReviews",value:function(e){return fetch(i.DATABASE_URL+"/reviews/?restaurant_id="+e).then(function(e){var t=e.json();return i.saveFetchedData("REVIEWS_R"+self.restaurant.id,t),t})}},{key:"postRestaurantReview",value:function(e){return fetch(i.DATABASE_URL+"/reviews/",{method:"POST",body:JSON.stringify(e)}).then(function(e){return e.json()})}},{key:"toggleFavorite",value:function(e,t){return fetch(i.DATABASE_URL+"/restaurants/"+e+"/?is_favorite="+t,{method:"PUT"}).then(function(e){return e.json()})}},{key:"fetchFavoriteRestaurants",value:function(){return fetch(i.DATABASE_URL+"/restaurants/?is_favorite=true").then(function(e){return e.json()})}},{key:"saveFetchedData",value:function(e,t){return window.localforage.setItem(e,t)}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),i}(),restaurant=void 0,rating=0,observer_config={threshold:[0,.5]};document.addEventListener("DOMContentLoaded",function(e){attachClickEvents(),window.addEventListener("online",checkForOfflineDataToPost),checkForOfflineDataToPost()}),window.initMap=function(){fetchRestaurantFromURL(function(e,t){if(e)console.error(e);else{var n=document.getElementById("map-container");n.setAttribute("aria-label","map of "+t.name);var r=new IntersectionObserver(function(e){e.forEach(function(e){0<e.intersectionRatio&&e.intersectionRatio<.5?showStaticMap():.5<=e.intersectionRatio&&(showMap(),r.unobserve(e.target))})},observer_config);r.observe(n),fillBreadcrumb()}})};var showStaticMap=function(){var e=document.getElementById("static_map");if(self.restaurant&&self.restaurant.latlng){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n="https://maps.googleapis.com/maps/api/staticmap?center="+self.restaurant.latlng.lat+","+self.restaurant.latlng.lng+"&zoom=14&size="+t+"x400&format=jpg&maptype=roadmap&markers=color:red&key=AIzaSyDATtgo5EH-AGMQUgVipe74zk6kfOsiDaA";e.setAttribute("alt","map of "+self.restaurant.name+" restaurant"),e.setAttribute("src",n),e.style.display="block",document.getElementById("map").style.display="none"}},showMap=function(){var e=document.getElementById("static_map"),t=document.getElementById("map");self.restaurant&&self.restaurant.latlng&&(self.map=new google.maps.Map(t,{zoom:16,center:restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),e.style.display="none",t.style.display="block")},fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var o=getParameterByName("id");o?window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){if(t){var n=t.find(function(e){return e.id==o});handleFoundRestaurant(n,r)}else DBHelper.fetchRestaurantById(o,function(e,t){handleFoundRestaurant(t,r)})}):(error="No restaurant id in URL",r(error,null))}},handleFoundRestaurant=function(e,t){(self.restaurant=e)?(fillRestaurantHTML(),t(null,e)):console.error(error)},fillRestaurantHTML=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("map-container").setAttribute("aria-label","location of "+t.name+" on the map");var e=document.getElementById("restaurant-name");e.innerHTML=t.name;var n=document.createElement("input");n.className="rating fav",t.is_favorite="true"==t.is_favorite||1==t.is_favorite,!0===t.is_favorite?(n.value="✦",n.classList.add("gold"),n.setAttribute("title","Remove from favorites"),n.setAttribute("aria-label","remove "+t.name+" from favorites")):(n.value="✧",n.setAttribute("title","Add to favorites"),n.setAttribute("aria-label","add "+t.name+" to favorites")),n.setAttribute("type","button"),n.onclick=function(){t.is_favorite=!t.is_favorite,DBHelper.toggleFavorite(t.id,t.is_favorite).then(function(e){updateFavoriteStatus(n,t)})},e.append(n),document.getElementById("restaurant-address").innerHTML=t.address;var r=document.getElementById("restaurant-img"),o=r.parentElement,i=o.querySelector('source[type="image/webp"]'),a=o.querySelector('source[type="image/jpeg"]'),u=DBHelper.imageUrlForRestaurant(t);if(void 0!==u){u=u.replace(/\.jpg$/,""),i.setAttribute("srcset",u+"-300px.jpg 300w, "+u+"-420px.webp 400w, "+u+"-650px.webp 600w"),a.setAttribute("srcset",u+"-300px.jpg 300w, "+u+"-420px.jpg 400w, "+u+"-650px.jpg 600w");var c="(max-width: 667px) 70vw, (min-width: 667px) 30vw";i.setAttribute("sizes",c),a.setAttribute("sizes",c),r.setAttribute("sizes",c),r.setAttribute("alt","photo of "+t.name+" restaurant"),r.src=u+"-420px.jpg"}else r.setAttribute("alt","photo not available"),r.src="/img/icon-no-image.png";r.className="restaurant-img",document.getElementById("restaurant-cuisine").innerHTML=t.cuisine_type,t.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),o=document.createElement("td");o.innerHTML=n,r.appendChild(o);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},attachClickEvents=function(){self.getReadyToPostReview();var t=document.querySelectorAll(".rating-block > .rating");t&&t.forEach(function(e){e.onclick=function(){setRating(rating=e.getAttribute("data-value"),t)}})};function setRating(e,t){e-=1;for(var n=0;n<5;)n<=e&&!t[n].classList.contains("gold")&&(t[n].classList.add("gold"),t[n].value="★"),e<n&&t[n].classList.contains("gold")&&(t[n].classList.remove("gold"),t[n].value="☆"),n++}var getReadyToPostReview=function(){document.getElementById("add_review").onclick=function(){var e=validateReviewFormValues();e&&saveReview(e)}};function validateReviewFormValues(){console.log("btn");var e=document.getElementById("user_name");if(""===e.value)return alert("Please, enter your name"),void e.focus();if(0!==rating){var t=document.getElementById("review_comment");return""===t.value||t.value.length<10?(alert('Please, type a valid comment about "'+restaurant.name+'"'),void t.focus()):{restaurant_id:restaurant.id,name:e.value,rating:rating,comments:t.value}}alert('Please, enter a rating for "'+restaurant.name+'"')}function clearReviewFormFields(){rating=0,document.getElementById("user_name").value="";var e=document.querySelectorAll(".rating-block > .rating");e&&e.forEach(function(e){e.classList.remove("gold"),e.value="☆"}),document.getElementById("review_comment").value=""}function saveReview(e){console.log("save rev"),navigator.onLine?DBHelper.postRestaurantReview(e).then(function(e){console.log("saved online",e),clearReviewFormFields(),updateOfflineStorgae(!0,e)}).catch(function(e){console.log("error in saving review",e)}):!1===navigator.onLine?DBHelper.saveFetchedData(OFFLINE_REVIEWS_POST,e).then(function(){clearReviewFormFields(),createOfflineReviewHTML(e)}):DBHelper.postRestaurantReview(e).then(function(e){console.log("saved anyway",e),clearReviewFormFields(),updateOfflineStorgae(!0,e)}).catch(function(e){console.log("error in saving review",e)})}var fillReviewsHTML=function(){var n=document.getElementById("reviews-container"),r=new IntersectionObserver(function(e){e.forEach(function(e){if(0<e.intersectionRatio){var t=document.getElementById("loading-icon");t.setAttribute("src",t.getAttribute("data-src")),t.style.display="block",fetchReiews(n,t),r.unobserve(e.target)}})});r.observe(n)},fetchReiews=function(n,r){window.localforage.getItem("REVIEWS_R"+self.restaurant.id,function(e,t){t?doFillReviewsHTML(n,r,t):DBHelper.fetchRestaurantReviews(self.restaurant.id).then(function(e){doFillReviewsHTML(n,r,e)}).catch(function(e){r.style.display="none",console.log("error in fetching reviews: ",e)})})},doFillReviewsHTML=function(e,t,n){if(t.style.display="none",!n){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void e.appendChild(r)}var o=document.getElementById("reviews-list");o.innerHTML="",n.sort(compare).reverse().forEach(function(e){o.appendChild(createReviewHTML(e,!1))}),e.appendChild(o)},createReviewHTML=function(e,t){var n=document.createElement("li"),r=document.createElement("p");r.innerHTML=e.name,n.appendChild(r);var o=document.createElement("p");o.innerHTML=t?"Pending":new Date(e.updatedAt).toLocaleDateString(),n.appendChild(o);for(var i=document.createElement("p"),a="",u=1;u<=5;)a=a+" "+(u<=e.rating?'<span class="rating gold">&#9733;</span>':'<span class="rating">&#9734</span>'),u++;i.innerHTML="Rating: "+a,n.appendChild(i);var c=document.createElement("p");return c.innerHTML=e.comments,n.appendChild(c),n};function createOfflineReviewHTML(e){var t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");n.insertBefore(createReviewHTML(e,!0),n.firstChild),t.appendChild(n)}function checkForOfflineDataToPost(){self.localforage.getItem(OFFLINE_REVIEWS_POST,function(e,t){t?navigator.onLine&&DBHelper.postRestaurantReview(t).then(function(e){console.log("re-saved",e),self.localforage.removeItem("review_post"),updateOfflineStorgae(!0,e)}).catch(function(e){console.log("error in saving review",e)}):console.log("no offline data")});document.getElementById("connectionStatus");navigator.onLine?console.log("online",navigator.onLine):console.log("onifline",navigator.onLine)}function updateOfflineStorgae(r,o){window.localforage.getItem("REVIEWS_R"+self.restaurant.id,function(e,t){if(t){if(r)t.push(o);else{var n=t.find(function(e){return e.id==o.id});Object.assign(n,o)}DBHelper.saveFetchedData("REVIEWS_R"+self.restaurant.id,t)}}).then(function(){console.log("then after localforage"),fillReviewsHTML()})}function updateFavoriteStatus(e,n){!0===n.is_favorite?(e.value="✦",e.classList.add("gold"),e.setAttribute("title","Remove from favorites"),e.setAttribute("aria-label","remove "+n.name+" from favorites")):(e.value="✧",e.classList.remove("gold"),e.setAttribute("title","Add to favorites"),e.setAttribute("aria-label","add "+n.name+" to favorites")),window.localforage.getItem(RESTAURANTS_DBNAME,function(e,t){t&&(t.find(function(e){return e.id==n.id}).is_favorite=n.is_favorite,DBHelper.saveFetchedData(RESTAURANTS_DBNAME,t))})}function compare(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var polyfillsNeeded=[];"Promise"in self||polyfillsNeeded.push("/js/polyfills/promise.js"),"fetch"in self||polyfillsNeeded.push("/js/polyfills/fetch.js"),"IntersectionObserver"in self||polyfillsNeeded.push("/js/polyfills/intersection-observer.js"),polyfillsNeeded.forEach(function(e){var t=document.createElement("script");t.src=e,document.head.insertBefore(t,document.head.firstChild)}),window.registerServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").then(function(e){navigator.serviceWorker.controller&&console.log("SW registered")})},document.addEventListener("DOMContentLoaded",function(e){registerServiceWorker()});
//# sourceMappingURL=script_info.min.js.map
